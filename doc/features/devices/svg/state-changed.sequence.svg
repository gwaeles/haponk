<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="679px" preserveAspectRatio="none" style="width:879px;height:679px;background:#FFFFFF;" version="1.1" viewBox="0 0 879 679" width="879px" zoomAndPan="magnify"><defs/><g><rect fill="#90CAF9" height="660.9453" style="stroke:#181818;stroke-width:0.5;" width="91" x="1" y="6"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="85" x="4" y="18.5684">Presentation</text><rect fill="#BBDEFB" height="660.9453" style="stroke:#181818;stroke-width:0.5;" width="248" x="94" y="6"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="90" x="173" y="18.5684">Domain layer</text><rect fill="#E3F2FD" height="660.9453" style="stroke:#181818;stroke-width:0.5;" width="527" x="344" y="6"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="69" x="573" y="18.5684">Data layer</text><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="46.5" x2="46.5" y1="87.7988" y2="601.457"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="141" x2="141" y1="87.7988" y2="601.457"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="266" x2="266" y1="87.7988" y2="601.457"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="417" x2="417" y1="87.7988" y2="601.457"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="545" x2="545" y1="87.7988" y2="601.457"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="687" x2="687" y1="87.7988" y2="601.457"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="823" x2="823" y1="87.7988" y2="601.457"/><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="42" x="25.5" y="56.3105"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="28" x="32.5" y="76.8457">App</text><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="42" x="25.5" y="600.457"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="28" x="32.5" y="620.9922">App</text><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="86" x="98" y="56.3105"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="72" x="105" y="76.8457">DeviceBloc</text><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="86" x="98" y="600.457"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="72" x="105" y="620.9922">DeviceBloc</text><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="144" x="194" y="56.3105"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="130" x="201" y="76.8457">ConnectionNotifier</text><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="144" x="194" y="600.457"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="130" x="201" y="620.9922">ConnectionNotifier</text><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="138" x="348" y="56.3105"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="124" x="355" y="76.8457">DevicesRepository</text><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="138" x="348" y="600.457"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="124" x="355" y="620.9922">DevicesRepository</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="92" x="496" y="84.8457">Local Storage</text><path d="M527,35.3105 C527,25.3105 545,25.3105 545,25.3105 C545,25.3105 563,25.3105 563,35.3105 L563,61.3105 C563,71.3105 545,71.3105 545,71.3105 C545,71.3105 527,71.3105 527,61.3105 L527,35.3105 " fill="#E2E2F0" style="stroke:#181818;stroke-width:1.5;"/><path d="M527,35.3105 C527,45.3105 545,45.3105 545,45.3105 C545,45.3105 563,45.3105 563,35.3105 " fill="none" style="stroke:#181818;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="92" x="496" y="613.9922">Local Storage</text><path d="M527,626.9453 C527,616.9453 545,616.9453 545,616.9453 C545,616.9453 563,616.9453 563,626.9453 L563,652.9453 C563,662.9453 545,662.9453 545,662.9453 C545,662.9453 527,662.9453 527,652.9453 L527,626.9453 " fill="#E2E2F0" style="stroke:#181818;stroke-width:1.5;"/><path d="M527,626.9453 C527,636.9453 545,636.9453 545,636.9453 C545,636.9453 563,636.9453 563,626.9453 " fill="none" style="stroke:#181818;stroke-width:1.5;"/><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="166" x="604" y="56.3105"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="152" x="611" y="76.8457">ConnectionRepository</text><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="166" x="604" y="600.457"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="152" x="611" y="620.9922">ConnectionRepository</text><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="87" x="780" y="56.3105"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="73" x="787" y="76.8457">Websocket</text><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="87" x="780" y="600.457"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="73" x="787" y="620.9922">Websocket</text><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="872" x="0" y="118.4541"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="872" y1="118.4541" y2="118.4541"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="872" y1="121.4541" y2="121.4541"/><rect fill="#EEEEEE" height="23.3105" style="stroke:#000000;stroke-width:2.0;" width="118" x="377" y="107.7988"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="100" x="383" y="124.3672">On app launch</text><polygon fill="#181818" points="254,158.4199,264,162.4199,254,166.4199,258,162.4199" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="46.5" x2="260" y1="162.4199" y2="162.4199"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="45" x="53.5" y="157.6777">watch()</text><polygon fill="#181818" points="675,187.7305,685,191.7305,675,195.7305,679,191.7305" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="266" x2="681" y1="191.7305" y2="191.7305"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="43" x="273" y="186.9883">listen()</text><polygon fill="#181818" points="811.5,217.041,821.5,221.041,811.5,225.041,815.5,221.041" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="687" x2="817.5" y1="221.041" y2="221.041"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="58" x="694" y="216.2988">connect()</text><polygon fill="#181818" points="129,246.3516,139,250.3516,129,254.3516,133,250.3516" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="46.5" x2="135" y1="250.3516" y2="250.3516"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="45" x="53.5" y="245.6094">watch()</text><polygon fill="#181818" points="405,275.6621,415,279.6621,405,283.6621,409,279.6621" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="141" x2="411" y1="279.6621" y2="279.6621"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="94" x="148" y="274.9199">watchDevices()</text><polygon fill="#181818" points="533,304.9727,543,308.9727,533,312.9727,537,308.9727" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="417" x2="539" y1="308.9727" y2="308.9727"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="94" x="424" y="304.2305">watchDevices()</text><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="872" x="0" y="337.6279"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="872" y1="337.6279" y2="337.6279"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="872" y1="340.6279" y2="340.6279"/><rect fill="#EEEEEE" height="23.3105" style="stroke:#000000;stroke-width:2.0;" width="146" x="363" y="326.9727"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="128" x="369" y="343.541">State changed flow</text><polygon fill="#181818" points="698,377.5938,688,381.5938,698,385.5938,694,381.5938" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="692" x2="822.5" y1="381.5938" y2="381.5938"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="85" x="704" y="376.8516">StateMessage</text><polygon fill="#181818" points="556,406.9043,546,410.9043,556,414.9043,552,410.9043" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="550" x2="686" y1="410.9043" y2="410.9043"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="82" x="562" y="406.1621">updateState()</text><polygon fill="#181818" points="428,436.2148,418,440.2148,428,444.2148,424,440.2148" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="422" x2="544" y1="440.2148" y2="440.2148"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="53" x="434" y="435.4727">onData()</text><line style="stroke:#181818;stroke-width:1.0;" x1="417" x2="459" y1="469.5254" y2="469.5254"/><line style="stroke:#181818;stroke-width:1.0;" x1="459" x2="459" y1="469.5254" y2="482.5254"/><line style="stroke:#181818;stroke-width:1.0;" x1="418" x2="459" y1="482.5254" y2="482.5254"/><polygon fill="#181818" points="428,478.5254,418,482.5254,428,486.5254,424,482.5254" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="62" x="424" y="464.7832">sink.add()</text><polygon fill="#181818" points="152,507.8359,142,511.8359,152,515.8359,148,511.8359" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="146" x2="416" y1="511.8359" y2="511.8359"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="53" x="158" y="507.0938">onData()</text><line style="stroke:#181818;stroke-width:1.0;" x1="141" x2="183" y1="541.1465" y2="541.1465"/><line style="stroke:#181818;stroke-width:1.0;" x1="183" x2="183" y1="541.1465" y2="554.1465"/><line style="stroke:#181818;stroke-width:1.0;" x1="142" x2="183" y1="554.1465" y2="554.1465"/><polygon fill="#181818" points="152,550.1465,142,554.1465,152,558.1465,148,554.1465" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="36" x="148" y="536.4043">emit()</text><polygon fill="#181818" points="57.5,579.457,47.5,583.457,57.5,587.457,53.5,583.457" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="51.5" x2="140" y1="583.457" y2="583.457"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="40" x="63.5" y="578.7148">build()</text><!--MD5=[04ade057636ca235fe603b84c7864026]
@startuml state-changed.sequence

box "Presentation" #90CAF9
participant App
end box

box "Domain layer" #BBDEFB
participant DeviceBloc
participant ConnectionNotifier
end box

box "Data layer" #E3F2FD
participant DevicesRepository
participant ConnectionRepository
database "Local Storage" as LocalStorage
participant ConnectionRepository
participant Websocket
end box

== On app launch ==
App - -> ConnectionNotifier : watch()
ConnectionNotifier - -> ConnectionRepository : listen()
ConnectionRepository - -> Websocket : connect()
App - -> DeviceBloc : watch()
DeviceBloc - -> DevicesRepository : watchDevices()
DevicesRepository - -> LocalStorage : watchDevices()
== State changed flow ==
Websocket -> ConnectionRepository : StateMessage
ConnectionRepository -> LocalStorage : updateState()
LocalStorage -> DevicesRepository : onData()
DevicesRepository -> DevicesRepository : sink.add()
DevicesRepository -> DeviceBloc : onData()
DeviceBloc -> DeviceBloc : emit()
DeviceBloc -> App : build()


@enduml

PlantUML version 1.2022.7(Mon Aug 22 19:01:30 CEST 2022)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Default Encoding: UTF-8
Language: fr
Country: FR
--></g></svg>